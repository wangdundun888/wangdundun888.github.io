### TCP连接的建立与终止

---
一个tcp连接是由一对端点或套接字构成,其中通信的每一端都由一对(IP地址,端口号)所唯一标识

---

#### **三次握手**

    1.客户端发送一个SYN报文段(即启用tcp头部的SYN字段),同时指明自己想要连接端口号和它的客户端初始号(记为ISN(c)
    
    -> SYN,Seq=ISN(c)   SYN:synchronous 同步

    2.服务器收到客户端的SYN报文段后,发送自己的SYN报文段作为响应,包含自己的初始序列号(记为ISN(s),同时将ISN(c)加1
    后作为ACK的值,此时服务器可以确认客户端的发送功能正常

    -> SYN+ACK,Seq=ISN(s) ACK=ISN(c)+1

    3.客户端收到服务器的SYN+ACK后,启用ACK,将ISN(s)加1作为ACK的值发送,此时可以确认服务器收发功能正常

    ->ACK,Seq=ISN(c)+1,ACK=ISN(s)+1
    
    服务器收到客户端的第二次ACK报文后,可以确认客户端的接收功能正常.

---

    为什么需要三次握手?两次不行吗?

    第三次握手是为了防止失效的连接请求到达服务器，让服务器错误打开连接。

    客户端发送的连接请求如果在网络中滞留，那么就会隔很长一段时间才能收到服务器端发回的连接确认。

    客户端等待一个超时重传时间之后，就会重新请求连接。

    但是这个滞留的连接请求最后还是会到达服务器，如果不进行三次握手，那么服务器就会打开两个连接。

    如果有第三次握手，客户端会忽略服务器之后发送的对滞留连接请求的连接确认，不进行第三次握手，因此就不会再次打开连接。

#### **四次挥手**

    
    
    
